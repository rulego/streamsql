# StreamSQL ÂáΩÊï∞Á≥ªÁªüÊï¥ÂêàÊåáÂçó

Êú¨ÊñáÊ°£ËØ¥Êòé StreamSQL Â¶Ç‰ΩïÊï¥ÂêàËá™ÂÆö‰πâÂáΩÊï∞Á≥ªÁªüÔºå‰ª•Êèê‰æõÊõ¥Âº∫Â§ßÂíå‰∏∞ÂØåÁöÑË°®ËææÂºèËÆ°ÁÆóËÉΩÂäõÔºåÂåÖÊã¨Âº∫Â§ßÁöÑ CASE Êù°‰ª∂Ë°®ËææÂºèÊîØÊåÅ„ÄÇ

## üèóÔ∏è Êû∂ÊûÑÊ¶ÇËø∞

### ÂèåÂºïÊìéÊû∂ÊûÑ
StreamSQL Áé∞Âú®ÊîØÊåÅ‰∏§Â•óË°®ËææÂºèÂºïÊìéÔºö

1. **Ëá™ÂÆö‰πâ expr ÂºïÊìé** (`expr/expression.go`)
   - ‰∏ìÈó®ÈíàÂØπÊï∞ÂÄºËÆ°ÁÆó‰ºòÂåñ
   - ÊîØÊåÅÂü∫Êú¨Êï∞Â≠¶ËøêÁÆóÂíåÂáΩÊï∞
   - ËΩªÈáèÁ∫ßÔºåÈ´òÊÄßËÉΩ

2. **expr-lang/expr ÂºïÊìé** 
   - ÂäüËÉΩÂº∫Â§ßÁöÑÈÄöÁî®Ë°®ËææÂºèËØ≠Ë®Ä
   - ÊîØÊåÅÂ§çÊùÇÊï∞ÊçÆÁ±ªÂûãÔºàÊï∞ÁªÑ„ÄÅÂØπË±°„ÄÅÂ≠óÁ¨¶‰∏≤Á≠âÔºâ
   - ‰∏∞ÂØåÁöÑÂÜÖÁΩÆÂáΩÊï∞Â∫ì

### Ê°•Êé•Á≥ªÁªü
`functions/expr_bridge.go` Êèê‰æõ‰∫ÜÁªü‰∏ÄÁöÑÊé•Âè£ÔºåËá™Âä®ÈÄâÊã©ÊúÄÂêàÈÄÇÁöÑÂºïÊìéÂπ∂Êï¥Âêà‰∏§Â•óÂáΩÊï∞Á≥ªÁªü„ÄÇ

### Êù°‰ª∂Ë°®ËææÂºèÁ≥ªÁªü
StreamSQL ÂÜÖÁΩÆ‰∫ÜÂº∫Â§ßÁöÑ CASE Ë°®ËææÂºèÊîØÊåÅÔºåËÉΩÂ§üÊô∫ËÉΩÈÄâÊã©Ë°®ËææÂºèÂºïÊìéÔºö
- **ÁÆÄÂçïÊù°‰ª∂** ‚Üí Ëá™ÂÆö‰πâ expr ÂºïÊìéÔºàÈ´òÊÄßËÉΩÔºâ
- **Â§çÊùÇÂµåÂ•ó** ‚Üí expr-lang/expr ÂºïÊìéÔºàÂäüËÉΩÂÆåÊï¥Ôºâ

## üìö ÂèØÁî®ÂáΩÊï∞

### StreamSQL ÂÜÖÁΩÆÂáΩÊï∞

#### Êï∞Â≠¶ÂáΩÊï∞ (TypeMath)
| ÂáΩÊï∞            | ÊèèËø∞     | Á§∫‰æã                     |
|---------------|--------|------------------------|
| `abs(x)`      | ÁªùÂØπÂÄº    | `abs(-5)` ‚Üí `5`        |
| `sqrt(x)`     | Âπ≥ÊñπÊ†π    | `sqrt(16)` ‚Üí `4`       |
| `acos(x)`     | Âèç‰ΩôÂº¶    | `acos(0.5)` ‚Üí `1.047`  |
| `asin(x)`     | ÂèçÊ≠£Âº¶    | `asin(0.5)` ‚Üí `0.524`  |
| `atan(x)`     | ÂèçÊ≠£Âàá    | `atan(1)` ‚Üí `0.785`    |
| `atan2(y,x)`  | ÂèåÂèÇÊï∞ÂèçÊ≠£Âàá | `atan2(1,1)` ‚Üí `0.785` |
| `bitand(a,b)` | Êåâ‰Ωç‰∏é    | `bitand(5,3)` ‚Üí `1`    |
| `bitor(a,b)`  | Êåâ‰ΩçÊàñ    | `bitor(5,3)` ‚Üí `7`     |
| `bitxor(a,b)` | Êåâ‰ΩçÂºÇÊàñ   | `bitxor(5,3)` ‚Üí `6`    |
| `bitnot(x)`   | Êåâ‰ΩçÈùû    | `bitnot(5)` ‚Üí `-6`     |
| `ceiling(x)`  | Âêë‰∏äÂèñÊï¥   | `ceiling(3.2)` ‚Üí `4`   |
| `cos(x)`      | ‰ΩôÂº¶     | `cos(0)` ‚Üí `1`         |
| `cosh(x)`     | ÂèåÊõ≤‰ΩôÂº¶   | `cosh(0)` ‚Üí `1`        |
| `exp(x)`      | eÁöÑxÊ¨°ÂπÇ  | `exp(1)` ‚Üí `2.718`     |
| `floor(x)`    | Âêë‰∏ãÂèñÊï¥   | `floor(3.8)` ‚Üí `3`     |
| `ln(x)`       | Ëá™ÁÑ∂ÂØπÊï∞   | `ln(2.718)` ‚Üí `1`      |
| `power(x,y)`  | xÁöÑyÊ¨°ÂπÇ  | `power(2,3)` ‚Üí `8`     |

#### Â≠óÁ¨¶‰∏≤ÂáΩÊï∞ (TypeString)
| ÂáΩÊï∞                  | ÊèèËø∞    | Á§∫‰æã                                              |
|---------------------|-------|-------------------------------------------------|
| `concat(s1,s2,...)` | Â≠óÁ¨¶‰∏≤ËøûÊé• | `concat("hello"," ","world")` ‚Üí `"hello world"` |
| `length(s)`         | Â≠óÁ¨¶‰∏≤ÈïøÂ∫¶ | `length("hello")` ‚Üí `5`                         |
| `upper(s)`          | ËΩ¨Â§ßÂÜô   | `upper("hello")` ‚Üí `"HELLO"`                    |
| `lower(s)`          | ËΩ¨Â∞èÂÜô   | `lower("HELLO")` ‚Üí `"hello"`                    |

#### ËΩ¨Êç¢ÂáΩÊï∞ (TypeConversion)
| ÂáΩÊï∞                     | ÊèèËø∞       | Á§∫‰æã                                         |
|------------------------|----------|--------------------------------------------|
| `cast(value, type)`    | Á±ªÂûãËΩ¨Êç¢     | `cast("123", "int64")` ‚Üí `123`             |
| `hex2dec(hex)`         | ÂçÅÂÖ≠ËøõÂà∂ËΩ¨ÂçÅËøõÂà∂ | `hex2dec("ff")` ‚Üí `255`                    |
| `dec2hex(num)`         | ÂçÅËøõÂà∂ËΩ¨ÂçÅÂÖ≠ËøõÂà∂ | `dec2hex(255)` ‚Üí `"ff"`                    |
| `encode(data, format)` | ÁºñÁ†Å       | `encode("hello", "base64")` ‚Üí `"aGVsbG8="` |
| `decode(data, format)` | Ëß£Á†Å       | `decode("aGVsbG8=", "base64")` ‚Üí `"hello"` |

#### Êó∂Èó¥Êó•ÊúüÂáΩÊï∞ (TypeDateTime)
| ÂáΩÊï∞               | ÊèèËø∞               | Á§∫‰æã                                |
|------------------|------------------|-----------------------------------|
| `now()`          | ÂΩìÂâçÊó∂Èó¥Êà≥            | `now()` ‚Üí `1640995200`            |
| `current_time()` | ÂΩìÂâçÊó∂Èó¥(HH:MM:SS)   | `current_time()` ‚Üí `"14:30:25"`   |
| `current_date()` | ÂΩìÂâçÊó•Êúü(YYYY-MM-DD) | `current_date()` ‚Üí `"2025-01-01"` |

#### ËÅöÂêàÂáΩÊï∞ (TypeAggregation)
| ÂáΩÊï∞            | ÊèèËø∞  | Á§∫‰æã                        |
|---------------|-----|---------------------------|
| `sum(...)`    | Ê±ÇÂíå  | `sum(1,2,3)` ‚Üí `6`        |
| `avg(...)`    | Âπ≥ÂùáÂÄº | `avg(1,2,3)` ‚Üí `2`        |
| `min(...)`    | ÊúÄÂ∞èÂÄº | `min(1,2,3)` ‚Üí `1`        |
| `max(...)`    | ÊúÄÂ§ßÂÄº | `max(1,2,3)` ‚Üí `3`        |
| `count(...)`  | ËÆ°Êï∞  | `count(1,2,3)` ‚Üí `3`      |
| `stddev(...)` | Ê†áÂáÜÂ∑Æ | `stddev(1,2,3)` ‚Üí `0.816` |
| `median(...)` | ‰∏≠‰ΩçÊï∞ | `median(1,2,3)` ‚Üí `2`     |

### expr-lang/expr ÂÜÖÁΩÆÂáΩÊï∞

#### Êï∞Â≠¶ÂáΩÊï∞
| ÂáΩÊï∞         | ÊèèËø∞   | Á§∫‰æã                 |
|------------|------|--------------------|
| `abs(x)`   | ÁªùÂØπÂÄº  | `abs(-5)` ‚Üí `5`    |
| `ceil(x)`  | Âêë‰∏äÂèñÊï¥ | `ceil(3.2)` ‚Üí `4`  |
| `floor(x)` | Âêë‰∏ãÂèñÊï¥ | `floor(3.8)` ‚Üí `3` |
| `round(x)` | ÂõõËàç‰∫îÂÖ• | `round(3.6)` ‚Üí `4` |
| `max(a,b)` | ÊúÄÂ§ßÂÄº  | `max(5,3)` ‚Üí `5`   |
| `min(a,b)` | ÊúÄÂ∞èÂÄº  | `min(5,3)` ‚Üí `3`   |

#### Â≠óÁ¨¶‰∏≤ÂáΩÊï∞
| ÂáΩÊï∞                     | ÊèèËø∞     | Á§∫‰æã                                       |
|------------------------|--------|------------------------------------------|
| `trim(s)`              | ÂéªÈô§È¶ñÂ∞æÁ©∫Ê†º | `trim("  hello  ")` ‚Üí `"hello"`          |
| `upper(s)`             | ËΩ¨Â§ßÂÜô    | `upper("hello")` ‚Üí `"HELLO"`             |
| `lower(s)`             | ËΩ¨Â∞èÂÜô    | `lower("HELLO")` ‚Üí `"hello"`             |
| `split(s, delimiter)`  | ÂàÜÂâ≤Â≠óÁ¨¶‰∏≤  | `split("a,b,c", ",")` ‚Üí `["a","b","c"]`  |
| `replace(s, old, new)` | ÊõøÊç¢Â≠óÁ¨¶‰∏≤  | `replace("hello", "l", "x")` ‚Üí `"hexxo"` |
| `indexOf(s, sub)`      | Êü•ÊâæÂ≠ê‰∏≤‰ΩçÁΩÆ | `indexOf("hello", "ll")` ‚Üí `2`           |
| `hasPrefix(s, prefix)` | Ê£ÄÊü•ÂâçÁºÄ   | `hasPrefix("hello", "he")` ‚Üí `true`      |
| `hasSuffix(s, suffix)` | Ê£ÄÊü•ÂêéÁºÄ   | `hasSuffix("hello", "lo")` ‚Üí `true`      |

#### Êï∞ÁªÑ/ÈõÜÂêàÂáΩÊï∞
| ÂáΩÊï∞                         | ÊèèËø∞        | Á§∫‰æã                                     |
|----------------------------|-----------|----------------------------------------|
| `all(array, predicate)`    | ÊâÄÊúâÂÖÉÁ¥†Êª°Ë∂≥Êù°‰ª∂  | `all([2,4,6], # % 2 == 0)` ‚Üí `true`    |
| `any(array, predicate)`    | ‰ªª‰∏ÄÂÖÉÁ¥†Êª°Ë∂≥Êù°‰ª∂  | `any([1,3,4], # % 2 == 0)` ‚Üí `true`    |
| `filter(array, predicate)` | ËøáÊª§ÂÖÉÁ¥†      | `filter([1,2,3,4], # > 2)` ‚Üí `[3,4]`   |
| `map(array, expression)`   | ËΩ¨Êç¢ÂÖÉÁ¥†      | `map([1,2,3], # * 2)` ‚Üí `[2,4,6]`      |
| `find(array, predicate)`   | Êü•ÊâæÂÖÉÁ¥†      | `find([1,2,3], # > 2)` ‚Üí `3`           |
| `count(array, predicate)`  | ËÆ°Êï∞Êª°Ë∂≥Êù°‰ª∂ÁöÑÂÖÉÁ¥† | `count([1,2,3,4], # > 2)` ‚Üí `2`        |
| `concat(array1, array2)`   | ËøûÊé•Êï∞ÁªÑ      | `concat([1,2], [3,4])` ‚Üí `[1,2,3,4]`   |
| `flatten(array)`           | Â±ïÂπ≥Êï∞ÁªÑ      | `flatten([[1,2],[3,4]])` ‚Üí `[1,2,3,4]` |
| `len(value)`               | Ëé∑ÂèñÈïøÂ∫¶      | `len([1,2,3])` ‚Üí `3`                   |

#### Êó∂Èó¥ÂáΩÊï∞
| ÂáΩÊï∞            | ÊèèËø∞    | Á§∫‰æã                            |
|---------------|-------|-------------------------------|
| `now()`       | ÂΩìÂâçÊó∂Èó¥  | `now()` ‚Üí `Êó∂Èó¥ÂØπË±°`              |
| `duration(s)` | Ëß£ÊûêÊó∂Èó¥ÊÆµ | `duration("1h30m")` ‚Üí `Êó∂Èó¥ÊÆµÂØπË±°` |
| `date(s)`     | Ëß£ÊûêÊó•Êúü  | `date("2023-12-01")` ‚Üí `Êó•ÊúüÂØπË±°` |

#### Á±ªÂûãËΩ¨Êç¢ÂáΩÊï∞
| ÂáΩÊï∞ | ÊèèËø∞ | Á§∫‰æã |
|------|------|------|
| `int(x)` | ËΩ¨Êï¥Êï∞ | `int("123")` ‚Üí `123` |
| `float(x)` | ËΩ¨ÊµÆÁÇπÊï∞ | `float("123.45")` ‚Üí `123.45` |
| `string(x)` | ËΩ¨Â≠óÁ¨¶‰∏≤ | `string(123)` ‚Üí `"123"` |
| `type(x)` | Ëé∑ÂèñÁ±ªÂûã | `type(123)` ‚Üí `"int"` |

#### JSON/ÁºñÁ†ÅÂáΩÊï∞
| ÂáΩÊï∞              | ÊèèËø∞       | Á§∫‰æã                                   |
|-----------------|----------|--------------------------------------|
| `toJSON(x)`     | ËΩ¨JSON    | `toJSON({"a":1})` ‚Üí `'{"a":1}'`      |
| `fromJSON(s)`   | Ëß£ÊûêJSON   | `fromJSON('{"a":1}')` ‚Üí `{"a":1}`    |
| `toBase64(s)`   | Base64ÁºñÁ†Å | `toBase64("hello")` ‚Üí `"aGVsbG8="`   |
| `fromBase64(s)` | Base64Ëß£Á†Å | `fromBase64("aGVsbG8=")` ‚Üí `"hello"` |

## üéØ Êù°‰ª∂Ë°®ËææÂºè

### CASEË°®ËææÂºè

StreamSQL ÊîØÊåÅÂº∫Â§ßÁöÑ CASE Êù°‰ª∂Ë°®ËææÂºèÔºåÁî®‰∫éÂÆûÁé∞Â§çÊùÇÁöÑÊù°‰ª∂ÈÄªËæëÂà§Êñ≠„ÄÇ

#### ËØ≠Ê≥ïÊîØÊåÅ

**ÊêúÁ¥¢CASEË°®ËææÂºè**Ôºö
```sql
CASE 
    WHEN condition1 THEN result1
    WHEN condition2 THEN result2
    ...
    ELSE default_result
END
```

**ÁÆÄÂçïCASEË°®ËææÂºè**Ôºö
```sql
CASE expression
    WHEN value1 THEN result1
    WHEN value2 THEN result2
    ...
    ELSE default_result
END
```

#### ÂäüËÉΩÁâπÊÄß

| ÁâπÊÄß | ÊîØÊåÅÁä∂ÊÄÅ | ÊèèËø∞ |
|------|----------|------|
| **Âü∫Êú¨Êù°‰ª∂Âà§Êñ≠** | ‚úÖ | ÊîØÊåÅ WHEN/THEN/ELSE ÈÄªËæë |
| **Â§öÈáçÊù°‰ª∂** | ‚úÖ | ÊîØÊåÅÂ§ö‰∏™ WHEN Â≠êÂè• |
| **ÈÄªËæëËøêÁÆóÁ¨¶** | ‚úÖ | ÊîØÊåÅ AND„ÄÅOR„ÄÅNOT Êìç‰Ωú |
| **ÊØîËæÉÊìç‰ΩúÁ¨¶** | ‚úÖ | ÊîØÊåÅ >„ÄÅ<„ÄÅ>=„ÄÅ<=„ÄÅ=„ÄÅ!= Á≠â |
| **Êï∞Â≠¶ÂáΩÊï∞** | ‚úÖ | ÊîØÊåÅ ABS„ÄÅROUND„ÄÅCEIL Á≠âÂáΩÊï∞Ë∞ÉÁî® |
| **ÁÆóÊúØË°®ËææÂºè** | ‚úÖ | ÊîØÊåÅ +„ÄÅ-„ÄÅ*„ÄÅ/ ËøêÁÆó |
| **Â≠óÁ¨¶‰∏≤Êìç‰Ωú** | ‚úÖ | ÊîØÊåÅÂ≠óÁ¨¶‰∏≤Â≠óÈù¢ÈáèÂíåÂáΩÊï∞ |
| **ËÅöÂêàÈõÜÊàê** | ‚úÖ | ÂèØÂú® SUM„ÄÅAVG„ÄÅCOUNT Á≠âËÅöÂêàÂáΩÊï∞‰∏≠‰ΩøÁî® |
| **Â≠óÊÆµÂºïÁî®** | ‚úÖ | ÊîØÊåÅÂä®ÊÄÅÂ≠óÊÆµÊèêÂèñÂíåËÆ°ÁÆó |
| **ÂµåÂ•óCASE** | ‚ö†Ô∏è | ÈÉ®ÂàÜÊîØÊåÅÔºàÂõûÈÄÄÂà∞ expr-langÔºâ |

#### ‰ΩøÁî®Á§∫‰æã

**ËÆæÂ§áÁä∂ÊÄÅÂàÜÁ±ª**Ôºö
```sql
SELECT deviceId,
    CASE 
        WHEN temperature > 30 AND humidity > 70 THEN 'CRITICAL'
        WHEN temperature > 25 OR humidity > 80 THEN 'WARNING'
        ELSE 'NORMAL'
    END as alert_level
FROM stream
```

**Êù°‰ª∂ËÅöÂêàÁªüËÆ°**Ôºö
```sql
SELECT deviceId,
    COUNT(CASE WHEN temperature > 25 THEN 1 END) as high_temp_count,
    SUM(CASE WHEN status = 'active' THEN temperature ELSE 0 END) as active_temp_sum,
    AVG(CASE WHEN humidity > 50 THEN humidity END) as avg_high_humidity
FROM stream
GROUP BY deviceId, TumblingWindow('5s')
```

**Êï∞Â≠¶ÂáΩÊï∞ÂíåÁÆóÊúØË°®ËææÂºè**Ôºö
```sql
SELECT deviceId,
    CASE 
        WHEN ABS(temperature - 25) < 5 THEN 'NORMAL'
        WHEN temperature * 1.8 + 32 > 100 THEN 'HOT_F'
        WHEN ROUND(temperature) = 20 THEN 'EXACT_20'
        ELSE 'OTHER'
    END as temp_classification
FROM stream
```

**Áä∂ÊÄÅÁ†ÅÊò†Â∞Ñ**Ôºö
```sql
SELECT deviceId,
    CASE status
        WHEN 'active' THEN 1
        WHEN 'inactive' THEN 0
        WHEN 'maintenance' THEN -1
        ELSE -999
    END as status_code
FROM stream
```

#### Ë°®ËææÂºèÂºïÊìéÈÄâÊã©

CASEË°®ËææÂºèÁöÑÂ§ÑÁêÜÈÅµÂæ™‰ª•‰∏ãËßÑÂàôÔºö

1. **ÁÆÄÂçïÊù°‰ª∂** ‚Üí ‰ΩøÁî®Ëá™ÂÆö‰πâ expr ÂºïÊìéÔºàÈ´òÊÄßËÉΩÔºâ
2. **ÂµåÂ•óCASEÊàñÂ§çÊùÇË°®ËææÂºè** ‚Üí Ëá™Âä®ÂõûÈÄÄÂà∞ expr-lang/exprÔºàÂäüËÉΩÂÆåÊï¥Ôºâ
3. **Ê∑∑ÂêàÂáΩÊï∞Ë∞ÉÁî®** ‚Üí Êô∫ËÉΩÈÄâÊã©ÊúÄÂêàÈÄÇÁöÑÂºïÊìé

#### ÊÄßËÉΩ‰ºòÂåñ

- **Êù°‰ª∂È°∫Â∫è**ÔºöÂ∞ÜÊúÄÂ∏∏ËßÅÁöÑÊù°‰ª∂ÊîæÂú®ÂâçÈù¢
- **ÂáΩÊï∞Ë∞ÉÁî®**ÔºöÈÅøÂÖçÂú®Êù°‰ª∂‰∏≠ÈáçÂ§çË∞ÉÁî®Áõ∏ÂêåÂáΩÊï∞
- **Á±ªÂûã‰∏ÄËá¥ÊÄß**Ôºö‰øùÊåÅTHENÂ≠êÂè•ËøîÂõûÁõ∏ÂêåÁ±ªÂûã‰ª•ÈÅøÂÖçËΩ¨Êç¢ÂºÄÈîÄ

## üîß ‰ΩøÁî®ÊñπÊ≥ï

### Âü∫Êú¨‰ΩøÁî®

```go
import "github.com/rulego/streamsql/functions"

// Áõ¥Êé•‰ΩøÁî®Ê°•Êé•Âô®ËØÑ‰º∞Ë°®ËææÂºè
result, err := functions.EvaluateWithBridge("abs(-5) + len([1,2,3])", map[string]interface{}{})
// result: 8 (5 + 3)

// CASEË°®ËææÂºèÁ§∫‰æã
caseResult, err := functions.EvaluateWithBridge(
    "CASE WHEN temperature > 30 THEN 'HOT' ELSE 'NORMAL' END", 
    map[string]interface{}{"temperature": 35.0})
// caseResult: "HOT"
```

### Âú® SQL Êü•ËØ¢‰∏≠‰ΩøÁî®

```sql
-- ‰ΩøÁî® StreamSQL ÂáΩÊï∞
SELECT device, abs(temperature - 20) as deviation 
FROM stream;

-- ‰ΩøÁî® expr-lang ÂáΩÊï∞
SELECT device, filter(measurements, # > 10) as high_values
FROM stream;

-- Ê∑∑Âêà‰ΩøÁî®
SELECT device, encode(concat(device, "_", string(now())), "base64") as device_id
FROM stream;
```

### Ë°®ËææÂºèÂºïÊìéÈÄâÊã©

Ë°®ËææÂºèÂºïÊìé‰ºöËá™Âä®ÈÄâÊã©Ôºö

1. **ÁÆÄÂçïÊï∞ÂÄºË°®ËææÂºè** ‚Üí ‰ΩøÁî®Ëá™ÂÆö‰πâ expr ÂºïÊìéÔºàÊõ¥Âø´Ôºâ
2. **Â§çÊùÇË°®ËææÂºèÊàñ‰ΩøÁî®È´òÁ∫ßÂáΩÊï∞** ‚Üí ‰ΩøÁî® expr-lang/exprÔºàÊõ¥Âº∫Â§ßÔºâ

### ÂáΩÊï∞ÂÜ≤Á™ÅËß£ÂÜ≥

ÂΩì‰∏§‰∏™Á≥ªÁªüÊúâÂêåÂêçÂáΩÊï∞Êó∂Ôºö

1. **ÈªòËÆ§‰ºòÂÖàÁ∫ß**Ôºöexpr-lang/expr > StreamSQL
2. **ËÆøÈóÆ StreamSQL ÁâàÊú¨**Ôºö‰ΩøÁî® `streamsql_` ÂâçÁºÄÔºåÂ¶Ç `streamsql_abs(-5)`
3. **ÊòéÁ°ÆÊåáÂÆö**ÔºöÈÄöËøáÂáΩÊï∞Ëß£ÊûêÂô®ÊâãÂä®ÈÄâÊã©

## üõ†Ô∏è È´òÁ∫ßÁî®Ê≥ï

### Ëé∑ÂèñÊâÄÊúâÂèØÁî®ÂáΩÊï∞

```go
info := functions.GetAllAvailableFunctions()
streamSQLFuncs := info["streamsql"]
exprLangFuncs := info["expr-lang"]
```

### Ëá™ÂÆö‰πâÂáΩÊï∞Ê≥®ÂÜå

```go
// Ê≥®ÂÜåÂà∞ StreamSQL Á≥ªÁªü
err := functions.RegisterCustomFunction("celsius_to_fahrenheit", 
    functions.TypeMath, "Ê∏©Â∫¶ËΩ¨Êç¢", "ÊëÑÊ∞èÂ∫¶ËΩ¨ÂçéÊ∞èÂ∫¶", 1, 1,
    func(ctx *functions.FunctionContext, args []interface{}) (interface{}, error) {
        celsius, _ := functions.ConvertToFloat64(args[0])
        return celsius*1.8 + 32, nil
    })

// ÂáΩÊï∞‰ºöËá™Âä®Âú®‰∏§‰∏™ÂºïÊìé‰∏≠ÂèØÁî®
```

### Ë°®ËææÂºèÁºñËØëÂíåÁºìÂ≠ò

```go
bridge := functions.GetExprBridge()

// ÁºñËØëË°®ËææÂºèÔºàÂèØÁºìÂ≠òÔºâ
program, err := bridge.CompileExpressionWithStreamSQLFunctions(
    "abs(temperature - 20) > 5", 
    map[string]interface{}{"temperature": 0.0})

// ÈáçÂ§çÊâßË°åÔºàÈ´òÊÄßËÉΩÔºâ
result, err := expr.Run(program, map[string]interface{}{"temperature": 25.5})
```

## üîç ÊÄßËÉΩËÄÉËôë

### ÈÄâÊã©ÂêàÈÄÇÁöÑÂºïÊìé

1. **Á∫ØÊï∞ÂÄºËÆ°ÁÆó**Ôºö‰ºòÂÖà‰ΩøÁî®Ëá™ÂÆö‰πâ expr ÂºïÊìé
2. **Â≠óÁ¨¶‰∏≤/Êï∞ÁªÑÊìç‰Ωú**Ôºö‰ΩøÁî® expr-lang/expr
3. **Â§çÊùÇÈÄªËæëË°®ËææÂºè**Ôºö‰ΩøÁî® expr-lang/expr

### ‰ºòÂåñÂª∫ËÆÆ

1. **È¢ÑÁºñËØëË°®ËææÂºè**ÔºöÂØπ‰∫éÈáçÂ§ç‰ΩøÁî®ÁöÑË°®ËææÂºèÔºåÈ¢ÑÁºñËØë‰ª•ÊèêÈ´òÊÄßËÉΩ
2. **ÂáΩÊï∞ÈÄâÊã©**Ôºö‰ºòÂÖà‰ΩøÁî®ÊÄßËÉΩÊõ¥Â•ΩÁöÑÁâàÊú¨
3. **Êï∞ÊçÆÁ±ªÂûã**ÔºöÈÅøÂÖç‰∏çÂøÖË¶ÅÁöÑÁ±ªÂûãËΩ¨Êç¢

## üìù Á§∫‰æã

### Ê∏©Â∫¶ÁõëÊéß

```sql
SELECT 
    device,
    temperature,
    abs(temperature - 20) as deviation,
    CASE 
        WHEN temperature > 30 THEN "hot"
        WHEN temperature < 10 THEN "cold" 
        ELSE "normal"
    END as status,
    encode(concat(device, "_", current_date()), "base64") as device_key
FROM temperature_stream 
WHERE abs(temperature - 20) > 5;
```

### Êô∫ËÉΩÂëäË≠¶Á≥ªÁªü

```sql
SELECT 
    device_id,
    timestamp,
    temperature,
    humidity,
    pressure,
    -- Â§öÁ∫ßÂëäË≠¶Âà§Êñ≠
    CASE 
        WHEN temperature > 40 AND humidity > 80 THEN 'CRITICAL_HEAT_HUMID'
        WHEN temperature > 35 OR humidity > 90 THEN 'WARNING_HIGH'
        WHEN temperature < 5 AND pressure < 950 THEN 'CRITICAL_COLD_LOW_PRESSURE'
        WHEN ABS(temperature - 25) < 2 AND humidity BETWEEN 40 AND 60 THEN 'OPTIMAL'
        ELSE 'NORMAL'
    END as alert_level,
    -- ËÆæÂ§áÁä∂ÊÄÅÊò†Â∞Ñ
    CASE device_status
        WHEN 'online' THEN 1
        WHEN 'offline' THEN 0
        WHEN 'maintenance' THEN -1
        ELSE -999
    END as status_code,
    -- Êù°‰ª∂ËÆ°ÁÆó
    CASE 
        WHEN temperature > 0 THEN ROUND(temperature * 1.8 + 32, 1)
        ELSE NULL
    END as fahrenheit_temp
FROM sensor_stream
WHERE device_id IS NOT NULL;
```

### Êù°‰ª∂ËÅöÂêàÂàÜÊûê

```sql
SELECT 
    device_type,
    location,
    -- Êù°‰ª∂ËÆ°Êï∞
    COUNT(CASE WHEN temperature > 30 THEN 1 END) as hot_readings,
    COUNT(CASE WHEN temperature < 10 THEN 1 END) as cold_readings,
    COUNT(CASE WHEN humidity > 70 THEN 1 END) as humid_readings,
    -- Êù°‰ª∂Ê±ÇÂíå
    SUM(CASE WHEN status = 'active' THEN power_consumption ELSE 0 END) as active_power_sum,
    -- Êù°‰ª∂Âπ≥ÂùáÂÄº
    AVG(CASE WHEN temperature BETWEEN 20 AND 30 THEN temperature END) as normal_temp_avg,
    -- Â§çÊùÇÊù°‰ª∂ÁªüËÆ°
    COUNT(CASE 
        WHEN temperature > 25 AND humidity < 60 AND status = 'active' 
        THEN 1 
    END) as optimal_active_count
FROM device_stream
GROUP BY device_type, location, TumblingWindow('10m')
HAVING COUNT(*) > 100;
```

### Êï∞ÊçÆÂ§ÑÁêÜ

```sql
SELECT 
    sensor_id,
    filter(readings, # > avg(readings)) as above_average,
    map(readings, round(#, 2)) as rounded_readings,
    len(readings) as reading_count
FROM sensor_data
WHERE len(readings) > 10;
```